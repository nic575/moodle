<<<<<<< OURS
{"version":3,"sources":["../src/view_manager.js"],"names":["define","$","Templates","Str","Notification","CalendarRepository","CalendarEvents","CalendarSelectors","ModalFactory","ModalEvents","SummaryModal","CustomEvents","registerEventListeners","root","on","links","eventLink","e","target","eventId","is","actions","viewEvent","closest","length","data","find","preventDefault","stopPropagation","renderEventSummaryModal","navLink","wrapper","view","courseId","categoryId","link","currentTarget","changeMonth","attr","changeDay","viewSelector","events","activate","option","hasClass","year","month","day","refreshMonthContent","then","window","history","pushState","fail","exception","refreshDayContent","reloadCurrentUpcoming","courseid","categoryid","template","startLoading","M","util","js_pending","get","join","includenavigation","mini","getCalendarMonthData","context","viewingmonth","render","html","js","replaceNode","trigger","viewUpdated","always","js_complete","stopLoading","url","arguments","monthChanged","getCalendarDayData","viewingday","dayChanged","loadingIconContainer","containers","loadingIcon","removeClass","addClass","getCalendarUpcomingData","viewingupcoming","getEventTypeClassFromType","eventType","typeClass","getEventById","getEventResponse","event","Error","eventData","normalisedeventtype","modalParams","title","name","type","TYPE","body","templateContext","canedit","candelete","headerclasses","isactionevent","create","done","modal","getRoot","hidden","destroy","show","init","reloadCurrentMonth","reloadCurrentDay"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A javascript module to handler calendar view changes.\n *\n * @module     core_calendar/view_manager\n * @package    core_calendar\n * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/templates',\n    'core/str',\n    'core/notification',\n    'core_calendar/repository',\n    'core_calendar/events',\n    'core_calendar/selectors',\n    'core/modal_factory',\n    'core/modal_events',\n    'core_calendar/summary_modal',\n    'core/custom_interaction_events',\n], function(\n    $,\n    Templates,\n    Str,\n    Notification,\n    CalendarRepository,\n    CalendarEvents,\n    CalendarSelectors,\n    ModalFactory,\n    ModalEvents,\n    SummaryModal,\n    CustomEvents\n) {\n\n        /**\n         * Register event listeners for the module.\n         *\n         * @param {object} root The root element.\n         */\n        var registerEventListeners = function(root) {\n            root = $(root);\n\n            // Bind click events to event links.\n            root.on('click', CalendarSelectors.links.eventLink, function(e) {\n                var target = $(e.target);\n                var eventId = null;\n\n                var eventLink;\n                if (target.is(CalendarSelectors.actions.viewEvent)) {\n                    eventLink = target;\n                } else {\n                    eventLink = target.closest(CalendarSelectors.actions.viewEvent);\n                }\n\n                if (eventLink.length) {\n                    eventId = eventLink.data('eventId');\n                } else {\n                    eventId = target.find(CalendarSelectors.actions.viewEvent).data('eventId');\n                }\n\n                if (eventId) {\n                    // A link was found. Show the modal.\n\n                    e.preventDefault();\n                    // We've handled the event so stop it from bubbling\n                    // and causing the day click handler to fire.\n                    e.stopPropagation();\n\n                    renderEventSummaryModal(eventId);\n                }\n            });\n\n\n            root.on('click', CalendarSelectors.links.navLink, function(e) {\n                var wrapper = root.find(CalendarSelectors.wrapper);\n                var view = wrapper.data('view');\n                var courseId = wrapper.data('courseid');\n                var categoryId = wrapper.data('categoryid');\n                var link = $(e.currentTarget);\n\n                if (view === 'month') {\n                    changeMonth(root, link.attr('href'), link.data('year'), link.data('month'), courseId, categoryId,\n                        link.data('day'));\n                    e.preventDefault();\n                } else if (view === 'day') {\n                    changeDay(root, link.attr('href'), link.data('year'), link.data('month'), link.data('day'),\n                        courseId, categoryId);\n                    e.preventDefault();\n                }\n\n            });\n\n            var viewSelector = root.find(CalendarSelectors.viewSelector);\n            CustomEvents.define(viewSelector, [CustomEvents.events.activate]);\n            viewSelector.on(\n                CustomEvents.events.activate,\n                function(e) {\n                    e.preventDefault();\n\n                    var option = $(e.target);\n                    if (option.hasClass('active')) {\n                        return;\n                    }\n\n                    var view = option.data('view'),\n                        year = option.data('year'),\n                        month = option.data('month'),\n                        day = option.data('day'),\n                        courseId = option.data('courseid'),\n                        categoryId = option.data('categoryid');\n\n                    if (view == 'month') {\n                        refreshMonthContent(root, year, month, courseId, categoryId, root, 'core_calendar/calendar_month', day)\n                            .then(function() {\n                                return window.history.pushState({}, '', '?view=month');\n                            }).fail(Notification.exception);\n                    } else if (view == 'day') {\n                        refreshDayContent(root, year, month, day, courseId, categoryId, root, 'core_calendar/calendar_day')\n                            .then(function() {\n                                return window.history.pushState({}, '', '?view=day');\n                            }).fail(Notification.exception);\n                    } else if (view == 'upcoming') {\n                        reloadCurrentUpcoming(root, courseId, categoryId, root, 'core_calendar/calendar_upcoming')\n                            .then(function() {\n                                return window.history.pushState({}, '', '?view=upcoming');\n                            }).fail(Notification.exception);\n                    }\n                }\n            );\n        };\n\n        /**\n         * Refresh the month content.\n         *\n         * @param {object} root The root element.\n         * @param {Number} year Year\n         * @param {Number} month Month\n         * @param {Number} courseid The id of the course whose events are shown\n         * @param {Number} categoryid The id of the category whose events are shown\n         * @param {object} target The element being replaced. If not specified, the calendarwrapper is used.\n         * @param {String} template The template to be rendered.\n         * @param {Number} day Day (optional)\n         * @return {promise}\n         */\n        var refreshMonthContent = function(root, year, month, courseid, categoryid, target, template, day) {\n            startLoading(root);\n\n            target = target || root.find(CalendarSelectors.wrapper);\n            template = template || root.attr('data-template');\n            day = day || 1;\n            M.util.js_pending([root.get('id'), year, month, courseid].join('-'));\n            var includenavigation = root.data('includenavigation');\n            var mini = root.data('mini');\n            return CalendarRepository.getCalendarMonthData(year, month, courseid, categoryid, includenavigation, mini, day)\n                .then(function(context) {\n                    context.viewingmonth = true;\n                    return Templates.render(template, context);\n                })\n                .then(function(html, js) {\n                    return Templates.replaceNode(target, html, js);\n                })\n                .then(function() {\n                    $('body').trigger(CalendarEvents.viewUpdated);\n                    return;\n                })\n                .always(function() {\n                    M.util.js_complete([root.get('id'), year, month, courseid].join('-'));\n                    return stopLoading(root);\n                })\n                .fail(Notification.exception);\n        };\n\n        /**\n         * Handle changes to the current calendar view.\n         *\n         * @param {object} root The container element\n         * @param {String} url The calendar url to be shown\n         * @param {Number} year Year\n         * @param {Number} month Month\n         * @param {Number} courseid The id of the course whose events are shown\n         * @param {Number} categoryid The id of the category whose events are shown\n         * @param {Number} day Day (optional)\n         * @return {promise}\n         */\n        var changeMonth = function(root, url, year, month, courseid, categoryid, day) {\n            day = day || 1;\n            return refreshMonthContent(root, year, month, courseid, categoryid, null, null, day)\n                .then(function() {\n                    if (url.length && url !== '#') {\n                        window.history.pushState({}, '', url);\n                    }\n                    return arguments;\n                })\n                .then(function() {\n                    $('body').trigger(CalendarEvents.monthChanged, [year, month, courseid, categoryid]);\n                    return arguments;\n                });\n        };\n\n        /**\n         * Reload the current month view data.\n         *\n         * @param {object} root The container element.\n         * @param {Number} courseId The course id.\n         * @param {Number} categoryId The id of the category whose events are shown\n         * @return {promise}\n         */\n        var reloadCurrentMonth = function(root, courseId, categoryId) {\n            var year = root.find(CalendarSelectors.wrapper).data('year');\n            var month = root.find(CalendarSelectors.wrapper).data('month');\n            var day = root.find(CalendarSelectors.wrapper).data('day');\n\n            if (typeof courseId === 'undefined') {\n                courseId = root.find(CalendarSelectors.wrapper).data('courseid');\n            }\n\n            if (typeof categoryId === 'undefined') {\n                categoryId = root.find(CalendarSelectors.wrapper).data('categoryid');\n            }\n\n            return refreshMonthContent(root, year, month, courseId, categoryId, null, null, day);\n        };\n\n\n        /**\n         * Refresh the day content.\n         *\n         * @param {object} root The root element.\n         * @param {Number} year Year\n         * @param {Number} month Month\n         * @param {Number} day Day\n         * @param {Number} courseid The id of the course whose events are shown\n         * @param {Number} categoryId The id of the category whose events are shown\n         * @param {object} target The element being replaced. If not specified, the calendarwrapper is used.\n         * @param {String} template The template to be rendered.\n         *\n         * @return {promise}\n         */\n        var refreshDayContent = function(root, year, month, day, courseid, categoryId, target, template) {\n            startLoading(root);\n\n            target = target || root.find(CalendarSelectors.wrapper);\n            template = template || root.attr('data-template');\n            M.util.js_pending([root.get('id'), year, month, day, courseid, categoryId].join('-'));\n            var includenavigation = root.data('includenavigation');\n            return CalendarRepository.getCalendarDayData(year, month, day, courseid, categoryId, includenavigation)\n                .then(function(context) {\n                    context.viewingday = true;\n                    return Templates.render(template, context);\n                })\n                .then(function(html, js) {\n                    return Templates.replaceNode(target, html, js);\n                })\n                .then(function() {\n                    $('body').trigger(CalendarEvents.viewUpdated);\n                    return;\n                })\n                .always(function() {\n                    M.util.js_complete([root.get('id'), year, month, day, courseid, categoryId].join('-'));\n                    return stopLoading(root);\n                })\n                .fail(Notification.exception);\n        };\n\n        /**\n         * Reload the current day view data.\n         *\n         * @param {object} root The container element.\n         * @param {Number} courseId The course id.\n         * @param {Number} categoryId The id of the category whose events are shown\n         * @return {promise}\n         */\n        var reloadCurrentDay = function(root, courseId, categoryId) {\n            var wrapper = root.find(CalendarSelectors.wrapper);\n            var year = wrapper.data('year');\n            var month = wrapper.data('month');\n            var day = wrapper.data('day');\n\n            if (!courseId) {\n                courseId = root.find(CalendarSelectors.wrapper).data('courseid');\n            }\n\n            if (typeof categoryId === 'undefined') {\n                categoryId = root.find(CalendarSelectors.wrapper).data('categoryid');\n            }\n\n            return refreshDayContent(root, year, month, day, courseId, categoryId);\n        };\n\n        /**\n         * Handle changes to the current calendar view.\n         *\n         * @param {object} root The root element.\n         * @param {String} url The calendar url to be shown\n         * @param {Number} year Year\n         * @param {Number} month Month\n         * @param {Number} day Day\n         * @param {Number} courseId The id of the course whose events are shown\n         * @param {Number} categoryId The id of the category whose events are shown\n         * @return {promise}\n         */\n        var changeDay = function(root, url, year, month, day, courseId, categoryId) {\n            return refreshDayContent(root, year, month, day, courseId, categoryId)\n                .then(function() {\n                    if (url.length && url !== '#') {\n                        window.history.pushState({}, '', url);\n                    }\n                    return arguments;\n                })\n                .then(function() {\n                    $('body').trigger(CalendarEvents.dayChanged, [year, month, courseId, categoryId]);\n                    return arguments;\n                });\n        };\n\n        /**\n         * Set the element state to loading.\n         *\n         * @param {object} root The container element\n         * @method startLoading\n         */\n        var startLoading = function(root) {\n            var loadingIconContainer = root.find(CalendarSelectors.containers.loadingIcon);\n\n            loadingIconContainer.removeClass('hidden');\n        };\n\n        /**\n         * Remove the loading state from the element.\n         *\n         * @param {object} root The container element\n         * @method stopLoading\n         */\n        var stopLoading = function(root) {\n            var loadingIconContainer = root.find(CalendarSelectors.containers.loadingIcon);\n\n            loadingIconContainer.addClass('hidden');\n        };\n\n        /**\n         * Reload the current month view data.\n         *\n         * @param {object} root The container element.\n         * @param {Number} courseId The course id.\n         * @param {Number} categoryId The id of the category whose events are shown\n         * @param {String} template The template to be rendered.\n         * @param {object} target The element being replaced. If not specified, the calendarwrapper is used.\n         * @return {promise}\n         */\n        var reloadCurrentUpcoming = function(root, courseId, categoryId, target, template) {\n            startLoading(root);\n\n            target = target || root.find(CalendarSelectors.wrapper);\n            template = template || root.attr('data-template');\n\n            if (typeof courseId === 'undefined') {\n                courseId = root.find(CalendarSelectors.wrapper).data('courseid');\n            }\n\n            if (typeof categoryId === 'undefined') {\n                categoryId = root.find(CalendarSelectors.wrapper).data('categoryid');\n            }\n\n            return CalendarRepository.getCalendarUpcomingData(courseId, categoryId)\n                .then(function(context) {\n                    context.viewingupcoming = true;\n                    return Templates.render(template, context);\n                })\n                .then(function(html, js) {\n                    return Templates.replaceNode(target, html, js);\n                })\n                .then(function() {\n                    $('body').trigger(CalendarEvents.viewUpdated);\n                    return;\n                })\n                .always(function() {\n                    return stopLoading(root);\n                })\n                .fail(Notification.exception);\n        };\n\n        /**\n         * Get the CSS class to apply for the given event type.\n         *\n         * @param {String} eventType The calendar event type\n         * @return {String}\n         */\n        var getEventTypeClassFromType = function(eventType) {\n            return 'calendar_event_' + eventType;\n        };\n\n        /**\n         * Render the event summary modal.\n         *\n         * @param {Number} eventId The calendar event id.\n         */\n        var renderEventSummaryModal = function(eventId) {\n            var typeClass = '';\n\n            // Calendar repository promise.\n            CalendarRepository.getEventById(eventId).then(function(getEventResponse) {\n                if (!getEventResponse.event) {\n                    throw new Error('Error encountered while trying to fetch calendar event with ID: ' + eventId);\n                }\n                var eventData = getEventResponse.event;\n                typeClass = getEventTypeClassFromType(eventData.normalisedeventtype);\n\n                return eventData;\n            }).then(function(eventData) {\n                // Build the modal parameters from the event data.\n                var modalParams = {\n                    title: eventData.name,\n                    type: SummaryModal.TYPE,\n                    body: Templates.render('core_calendar/event_summary_body', eventData),\n                    templateContext: {\n                        canedit: eventData.canedit,\n                        candelete: eventData.candelete,\n                        headerclasses: typeClass,\n                        isactionevent: eventData.isactionevent,\n                        url: eventData.url\n                    }\n                };\n\n                // Create the modal.\n                return ModalFactory.create(modalParams);\n\n            }).done(function(modal) {\n                // Handle hidden event.\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                    // Destroy when hidden.\n                    modal.destroy();\n                });\n\n                // Finally, render the modal!\n                modal.show();\n\n            }).fail(Notification.exception);\n        };\n\n        return {\n            init: function(root, view) {\n                registerEventListeners(root, view);\n            },\n            reloadCurrentMonth: reloadCurrentMonth,\n            changeMonth: changeMonth,\n            refreshMonthContent: refreshMonthContent,\n            reloadCurrentDay: reloadCurrentDay,\n            changeDay: changeDay,\n            refreshDayContent: refreshDayContent,\n            reloadCurrentUpcoming: reloadCurrentUpcoming\n        };\n    });\n"],"file":"view_manager.min.js"}
=======
{"version":3,"sources":["../src/view_manager.js"],"names":["registerEventListeners","root","on","CalendarSelectors","links","eventLink","e","target","eventId","matches","actions","viewEvent","closest","dataset","querySelector","preventDefault","stopPropagation","renderEventSummaryModal","navLink","wrapper","find","view","data","courseId","categoryId","link","currentTarget","changeMonth","href","year","month","day","changeDay","viewSelector","CustomEvents","define","events","activate","option","classList","contains","courseid","categoryid","refreshMonthContent","then","window","history","pushState","fail","Notification","exception","refreshDayContent","reloadCurrentUpcoming","template","startLoading","attr","M","util","js_pending","get","join","includenavigation","mini","CalendarRepository","getCalendarMonthData","context","viewingmonth","Templates","render","html","js","replaceNode","document","dispatchEvent","Event","CalendarEvents","viewUpdated","always","js_complete","stopLoading","url","length","args","trigger","monthChanged","reloadCurrentMonth","getCalendarDayData","viewingday","reloadCurrentDay","dayChanged","loadingIconContainer","containers","loadingIcon","removeClass","addClass","getCalendarUpcomingData","viewingupcoming","getEventTypeClassFromType","eventType","typeClass","getEventById","getEventResponse","event","Error","eventData","normalisedeventtype","modalParams","title","name","type","SummaryModal","TYPE","body","templateContext","canedit","candelete","headerclasses","isactionevent","ModalFactory","create","done","modal","getRoot","ModalEvents","hidden","destroy","show","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A javascript module to handler calendar view changes.\n *\n * @module     core_calendar/view_manager\n * @package    core_calendar\n * @copyright  2017 Andrew Nicols <andrew@nicols.co.uk>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport * as CalendarRepository from 'core_calendar/repository';\nimport CalendarEvents from 'core_calendar/events';\nimport * as CalendarSelectors from 'core_calendar/selectors';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport SummaryModal from 'core_calendar/summary_modal';\nimport CustomEvents from 'core/custom_interaction_events';\n\n/**\n * Register event listeners for the module.\n *\n * @param {object} root The root element.\n */\nconst registerEventListeners = (root) => {\n    root = $(root);\n\n    // Bind click events to event links.\n    root.on('click', CalendarSelectors.links.eventLink, (e) => {\n        const target = e.target;\n        let eventLink = null;\n        let eventId = null;\n\n        if (target.matches(CalendarSelectors.actions.viewEvent)) {\n            eventLink = target;\n        } else {\n            eventLink = target.closest(CalendarSelectors.actions.viewEvent);\n        }\n\n        if (eventLink) {\n            eventId = eventLink.dataset.eventId;\n        } else {\n            eventId = target.querySelector(CalendarSelectors.actions.viewEvent).dataset.eventId;\n        }\n\n        if (eventId) {\n            // A link was found. Show the modal.\n\n            e.preventDefault();\n            // We've handled the event so stop it from bubbling\n            // and causing the day click handler to fire.\n            e.stopPropagation();\n\n            renderEventSummaryModal(eventId);\n        }\n    });\n\n    root.on('click', CalendarSelectors.links.navLink, (e) => {\n        const wrapper = root.find(CalendarSelectors.wrapper);\n        const view = wrapper.data('view');\n        const courseId = wrapper.data('courseid');\n        const categoryId = wrapper.data('categoryid');\n        const link = e.currentTarget;\n\n        if (view === 'month') {\n            changeMonth(root, link.href, link.dataset.year, link.dataset.month, courseId, categoryId, link.dataset.day);\n            e.preventDefault();\n        } else if (view === 'day') {\n            changeDay(root, link.href, link.dataset.year, link.dataset.month, link.dataset.day, courseId, categoryId);\n            e.preventDefault();\n        }\n    });\n\n    const viewSelector = root.find(CalendarSelectors.viewSelector);\n    CustomEvents.define(viewSelector, [CustomEvents.events.activate]);\n    viewSelector.on(\n        CustomEvents.events.activate,\n        (e) => {\n            e.preventDefault();\n\n            const option = e.target;\n            if (option.classList.contains('active')) {\n                return;\n            }\n\n            const view = option.dataset.view,\n                year = option.dataset.year,\n                month = option.dataset.month,\n                day = option.dataset.day,\n                courseId = option.dataset.courseid,\n                categoryId = option.dataset.categoryid;\n\n            if (view == 'month') {\n                refreshMonthContent(root, year, month, courseId, categoryId, root, 'core_calendar/calendar_month', day)\n                    .then(() => {\n                        return window.history.pushState({}, '', '?view=month');\n                    }).fail(Notification.exception);\n            } else if (view == 'day') {\n                refreshDayContent(root, year, month, day, courseId, categoryId, root, 'core_calendar/calendar_day')\n                    .then(() => {\n                        return window.history.pushState({}, '', '?view=day');\n                    }).fail(Notification.exception);\n            } else if (view == 'upcoming') {\n                reloadCurrentUpcoming(root, courseId, categoryId, root, 'core_calendar/calendar_upcoming')\n                    .then(() => {\n                        return window.history.pushState({}, '', '?view=upcoming');\n                    }).fail(Notification.exception);\n            }\n        }\n    );\n};\n\n/**\n * Refresh the month content.\n *\n * @param {object} root The root element.\n * @param {number} year Year\n * @param {number} month Month\n * @param {number} courseId The id of the course whose events are shown\n * @param {number} categoryId The id of the category whose events are shown\n * @param {object} target The element being replaced. If not specified, the calendarwrapper is used.\n * @param {string} template The template to be rendered.\n * @param {number} day Day (optional)\n * @return {promise}\n */\nexport const refreshMonthContent = (root, year, month, courseId, categoryId, target = null, template = '', day = 1) => {\n    startLoading(root);\n\n    target = target || root.find(CalendarSelectors.wrapper);\n    template = template || root.attr('data-template');\n    M.util.js_pending([root.get('id'), year, month, courseId].join('-'));\n    const includenavigation = root.data('includenavigation');\n    const mini = root.data('mini');\n    return CalendarRepository.getCalendarMonthData(year, month, courseId, categoryId, includenavigation, mini, day)\n        .then(context => {\n            context.viewingmonth = true;\n            return Templates.render(template, context);\n        })\n        .then((html, js) => {\n            return Templates.replaceNode(target, html, js);\n        })\n        .then(() => {\n            document.querySelector('body').dispatchEvent(new Event(CalendarEvents.viewUpdated));\n            return;\n        })\n        .always(() => {\n            M.util.js_complete([root.get('id'), year, month, courseId].join('-'));\n            return stopLoading(root);\n        })\n        .fail(Notification.exception);\n};\n\n/**\n * Handle changes to the current calendar view.\n *\n * @param {object} root The container element\n * @param {string} url The calendar url to be shown\n * @param {number} year Year\n * @param {number} month Month\n * @param {number} courseId The id of the course whose events are shown\n * @param {number} categoryId The id of the category whose events are shown\n * @param {number} day Day (optional)\n * @return {promise}\n */\nexport const changeMonth = (root, url, year, month, courseId, categoryId, day = 1) => {\n    return refreshMonthContent(root, year, month, courseId, categoryId, null, '', day)\n        .then((...args) => {\n            if (url.length && url !== '#') {\n                window.history.pushState({}, '', url);\n            }\n            return args;\n        })\n        .then((...args) => {\n            $('body').trigger(CalendarEvents.monthChanged, [year, month, courseId, categoryId]);\n            return args;\n        });\n};\n\n/**\n * Reload the current month view data.\n *\n * @param {object} root The container element.\n * @param {number} courseId The course id.\n * @param {number} categoryId The id of the category whose events are shown\n * @return {promise}\n */\nexport const reloadCurrentMonth = (root, courseId = 0, categoryId = 0) => {\n    const year = root.find(CalendarSelectors.wrapper).data('year');\n    const month = root.find(CalendarSelectors.wrapper).data('month');\n    const day = root.find(CalendarSelectors.wrapper).data('day');\n\n    courseId = courseId || root.find(CalendarSelectors.wrapper).data('courseid');\n    categoryId = categoryId || root.find(CalendarSelectors.wrapper).data('categoryid');\n\n    return refreshMonthContent(root, year, month, courseId, categoryId, null, '', day);\n};\n\n\n/**\n * Refresh the day content.\n *\n * @param {object} root The root element.\n * @param {number} year Year\n * @param {number} month Month\n * @param {number} day Day\n * @param {number} courseId The id of the course whose events are shown\n * @param {number} categoryId The id of the category whose events are shown\n * @param {object} target The element being replaced. If not specified, the calendarwrapper is used.\n * @param {string} template The template to be rendered.\n *\n * @return {promise}\n */\nexport const refreshDayContent = (root, year, month, day, courseId, categoryId, target = null, template = '') => {\n    startLoading(root);\n\n    target = target || root.find(CalendarSelectors.wrapper);\n    template = template || root.attr('data-template');\n    M.util.js_pending([root.get('id'), year, month, day, courseId, categoryId].join('-'));\n    const includenavigation = root.data('includenavigation');\n    return CalendarRepository.getCalendarDayData(year, month, day, courseId, categoryId, includenavigation)\n        .then((context) => {\n            context.viewingday = true;\n            return Templates.render(template, context);\n        })\n        .then((html, js) => {\n            return Templates.replaceNode(target, html, js);\n        })\n        .then(() => {\n            document.querySelector('body').dispatchEvent(new Event(CalendarEvents.viewUpdated));\n            return;\n        })\n        .always(() => {\n            M.util.js_complete([root.get('id'), year, month, day, courseId, categoryId].join('-'));\n            return stopLoading(root);\n        })\n        .fail(Notification.exception);\n};\n\n/**\n * Reload the current day view data.\n *\n * @param {object} root The container element.\n * @param {number} courseId The course id.\n * @param {number} categoryId The id of the category whose events are shown\n * @return {promise}\n */\nexport const reloadCurrentDay = (root, courseId = 0, categoryId = 0) => {\n    const wrapper = root.find(CalendarSelectors.wrapper);\n    const year = wrapper.data('year');\n    const month = wrapper.data('month');\n    const day = wrapper.data('day');\n\n    courseId = courseId || root.find(CalendarSelectors.wrapper).data('courseid');\n    categoryId = categoryId || root.find(CalendarSelectors.wrapper).data('categoryid');\n\n    return refreshDayContent(root, year, month, day, courseId, categoryId);\n};\n\n/**\n * Handle changes to the current calendar view.\n *\n * @param {object} root The root element.\n * @param {String} url The calendar url to be shown\n * @param {Number} year Year\n * @param {Number} month Month\n * @param {Number} day Day\n * @param {Number} courseId The id of the course whose events are shown\n * @param {Number} categoryId The id of the category whose events are shown\n * @return {promise}\n */\nexport const changeDay = (root, url, year, month, day, courseId, categoryId) => {\n    return refreshDayContent(root, year, month, day, courseId, categoryId)\n        .then((...args) => {\n            if (url.length && url !== '#') {\n                window.history.pushState({}, '', url);\n            }\n            return args;\n        })\n        .then((...args) => {\n            $('body').trigger(CalendarEvents.dayChanged, [year, month, courseId, categoryId]);\n            return args;\n        });\n};\n\n/**\n * Set the element state to loading.\n *\n * @param {object} root The container element\n * @method startLoading\n */\nconst startLoading = (root) => {\n    const loadingIconContainer = root.find(CalendarSelectors.containers.loadingIcon);\n\n    loadingIconContainer.removeClass('hidden');\n};\n\n/**\n * Remove the loading state from the element.\n *\n * @param {object} root The container element\n * @method stopLoading\n */\nconst stopLoading = (root) => {\n    const loadingIconContainer = root.find(CalendarSelectors.containers.loadingIcon);\n\n    loadingIconContainer.addClass('hidden');\n};\n\n/**\n * Reload the current month view data.\n *\n * @param {object} root The container element.\n * @param {number} courseId The course id.\n * @param {number} categoryId The id of the category whose events are shown\n * @param {object} target The element being replaced. If not specified, the calendarwrapper is used.\n * @param {string} template The template to be rendered.\n * @return {promise}\n */\nexport const reloadCurrentUpcoming = (root, courseId = 0, categoryId = 0, target = null, template = '') => {\n    startLoading(root);\n\n    target = target || root.find(CalendarSelectors.wrapper);\n    template = template || root.attr('data-template');\n    courseId = courseId || root.find(CalendarSelectors.wrapper).data('courseid');\n    categoryId = categoryId || root.find(CalendarSelectors.wrapper).data('categoryid');\n\n    return CalendarRepository.getCalendarUpcomingData(courseId, categoryId)\n        .then((context) => {\n            context.viewingupcoming = true;\n            return Templates.render(template, context);\n        })\n        .then((html, js) => {\n            return Templates.replaceNode(target, html, js);\n        })\n        .then(() => {\n            document.querySelector('body').dispatchEvent(new Event(CalendarEvents.viewUpdated));\n            return;\n        })\n        .always(function() {\n            return stopLoading(root);\n        })\n        .fail(Notification.exception);\n};\n\n/**\n * Get the CSS class to apply for the given event type.\n *\n * @param {string} eventType The calendar event type\n * @return {string}\n */\nconst getEventTypeClassFromType = (eventType) => {\n    return 'calendar_event_' + eventType;\n};\n\n/**\n * Render the event summary modal.\n *\n * @param {Number} eventId The calendar event id.\n */\nconst renderEventSummaryModal = (eventId) => {\n    let typeClass = '';\n\n    // Calendar repository promise.\n    CalendarRepository.getEventById(eventId).then((getEventResponse) => {\n        if (!getEventResponse.event) {\n            throw new Error('Error encountered while trying to fetch calendar event with ID: ' + eventId);\n        }\n        const eventData = getEventResponse.event;\n        typeClass = getEventTypeClassFromType(eventData.normalisedeventtype);\n\n        return eventData;\n    }).then((eventData) => {\n        // Build the modal parameters from the event data.\n        const modalParams = {\n            title: eventData.name,\n            type: SummaryModal.TYPE,\n            body: Templates.render('core_calendar/event_summary_body', eventData),\n            templateContext: {\n                canedit: eventData.canedit,\n                candelete: eventData.candelete,\n                headerclasses: typeClass,\n                isactionevent: eventData.isactionevent,\n                url: eventData.url\n            }\n        };\n\n        // Create the modal.\n        return ModalFactory.create(modalParams);\n\n    }).done(function(modal) {\n        // Handle hidden event.\n        modal.getRoot().on(ModalEvents.hidden, function() {\n            // Destroy when hidden.\n            modal.destroy();\n        });\n\n        // Finally, render the modal!\n        modal.show();\n\n    }).fail(Notification.exception);\n};\n\nexport const init = (root, view) => {\n    registerEventListeners(root, view);\n};\n"],"file":"view_manager.min.js"}
>>>>>>> THEIRS
