define(["jquery"],function(a){"use strict";function b(){var b=a("#region-main form input.andnextrule");b.closest("label").length?b.closest("label").removeClass("hidden").last().addClass("hidden"):b.closest("span").removeClass("hidden").last().addClass("hidden")}function c(){var b=a("#region-main form");b.find(h.FIELDWRAPPER).removeClass("localprofile-flash").each(function(){var b=a(this);b.closest(".localprofile-combined").length&&b.unwrap()})}function d(){var c=null,d=a("#region-main form");d.find(h.FIELDWRAPPER).each(function(){var b=a(this),d=b.find("input.andnextrule");d.length&&(d.prop("checked")?c=c?c.add(b):b:c&&(c=c.add(b),c.wrapAll('<div class="localprofile-combined" />'),c=null))}),c&&(c.wrapAll('<div class="localprofile-combined" />'),c=null),b()}function e(){c(),d()}function f(b){var e=a(b.currentTarget),f=parseInt(e.data("lastPosition"),10),g=parseInt(e.val(),10);if(f!==g){var i=null,j=a(h.MOVETO);if(j.each(function(){var b=a(this);return b.attr("id")===e.attr("id")||parseInt(b.val(),10)!==g||(i=b.closest(h.FIELDWRAPPER),!1)}),i){c();var k=e.closest(h.FIELDWRAPPER);g<f?k.insertBefore(i):k.insertAfter(i),j=a(h.MOVETO),j.each(function(b){var c=a(this),d=b+1;c.data("lastPosition",d),c.val(d),c.closest(h.FIELDWRAPPER).find(h.RULENUMBER).html(d)}),k.removeClass("localprofile-flash").addClass("localprofile-flash"),d()}}}function g(){var b=a("#region-main form input.deleterule");b.each(function(){var b=a(this),c=b.closest(".localprofile-fieldwrapper");b.prop("checked")?(c.addClass("todelete"),c.find(":input:not(.deleterule)").prop("disabled",!0)):(c.removeClass("todelete"),c.find(":input").prop("disabled",!1))})}var h={MOVETO:"select.moveto, .moveto select",FIELDWRAPPER:".localprofile-fieldwrapper",RULENUMBER:".localprofile-number"};return{init:function(){var b=a("#region-main form");b.find(h.MOVETO).each(function(){var b=a(this);b.data("lastPosition",b.val())}),b.on("change",h.MOVETO,f),b.on("change","input.andnextrule",e),b.on("change","input.deleterule",g),d()}}});